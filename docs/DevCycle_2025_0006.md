# Development Cycle 2025-0006

**Status:** ❌ TODO  
**Start Date:** August 9, 2025  
**Target Completion:** TBD  
**Focus:** Test Build Version 0.0.1 and Bug Discovery - comprehensive testing and issue tracking

## Overview

This development cycle focuses on thorough testing of the current Singventory application (version 0.0.1) to identify bugs, issues, and areas for improvement. With DevCycle 5 having completed the core karaoke session management system, this cycle shifts to quality assurance and bug tracking to ensure a stable and reliable user experience.

## Current Work Items

### Phase 1 - Test Build 0.0.1 Comprehensive Testing
**Status:** ❌ TODO  
**Priority:** Critical  
**Description:** Systematically test all functionality implemented in DevCycles 1-5 to identify bugs, edge cases, and usability issues

#### Phase Progress
**Phase 1 Comprehensive Testing Implementation:**
- ❌ TODO: Build and verify version 0.0.1 APK
- ❌ TODO: Set up test environment and test data scenarios
- ❌ TODO: Create test user workflows covering all major features
- ❌ TODO: Establish bug tracking and priority classification system
- ❌ TODO: Test song management (add, edit, delete, search)
- ❌ TODO: Test venue management (add, edit, delete, venue songs)
- ❌ TODO: Test visit management (start, active visit, end visit)
- ❌ TODO: Test performance logging (quick log, detailed log, editing)
- ❌ TODO: Test song-venue associations (add, edit, view associations)
- ❌ TODO: Test navigation flows between all screens
- ❌ TODO: Test configurable song selection modes (search vs dropdown)
- ❌ TODO: Test key adjustment displays and controls
- ❌ TODO: Test Material Design 3 theming and responsiveness
- ❌ TODO: Test error handling and edge cases
- ❌ TODO: Test performance statistics accuracy across CRUD operations
- ❌ TODO: Test database relationships and constraints
- ❌ TODO: Test data persistence across app restarts
- ❌ TODO: Test concurrent data operations and race conditions
- ❌ TODO: Test app performance with large datasets
- ❌ TODO: Test memory usage and potential leaks
- ❌ TODO: Test edge cases (empty states, invalid inputs, network issues)
- ❌ TODO: Test accessibility features and compatibility

#### Technical Testing Requirements
**Build Verification:**
- Confirm version 0.0.1 builds successfully for debug and release
- Verify all navigation actions work correctly
- Ensure all database migrations and schemas are valid
- Test APK installation and first-run experience

**Feature Coverage Testing:**
- All screens accessible and functional
- All CRUD operations work as expected
- Statistics calculations are accurate
- Configuration settings persist and apply correctly

**Bug Classification System:**
- **Critical**: App crashes, data loss, core functionality broken
- **High**: Major feature not working, significant UX issues
- **Medium**: Minor feature issues, cosmetic problems
- **Low**: Enhancement opportunities, minor UX improvements

#### Bug Tracking Format
For each discovered bug:
```
**Bug ID:** BUG-YYYY-NNNN
**Priority:** [Critical/High/Medium/Low]
**Component:** [Song Management/Venue Management/Visit Management/Performance Logging/UI/Data]
**Description:** [Clear description of the issue]
**Steps to Reproduce:** [Detailed reproduction steps]
**Expected Behavior:** [What should happen]
**Actual Behavior:** [What actually happens]
**Test Environment:** [Version, device, conditions]
**Status:** [New/In Progress/Fixed/Verified]
```

#### Test Scenarios to Cover
**Happy Path Scenarios:**
- Complete visit workflow from start to performance logging to end
- Song and venue management with associations
- Performance editing and statistics updates

**Edge Case Scenarios:**
- Empty database first-run
- Very long song/venue names
- Invalid input handling
- Concurrent operations
- App backgrounding/foregrounding

**Error Scenarios:**
- Network connectivity issues (if applicable)
- Database corruption recovery
- Invalid data states
- Memory pressure conditions

### Phase 2 - Settings Page Improvements
**Status:** ✅ COMPLETED  
**Priority:** Medium  
**Description:** Reorganize and clean up the Settings page layout and remove unnecessary features

#### Phase Progress
**Phase 2 Settings Page Reorganization Implementation:**
- ✅ COMPLETED: Move Data Management section above Data Overview
- ✅ COMPLETED: Remove Relationship Statistics section and tracking
- ✅ COMPLETED: Remove Backup Data button and backup reminders
- ✅ COMPLETED: Add app information section below Data Overview (app title, owner, build number)
- ✅ COMPLETED: Update SettingsViewModel to remove relationship statistics logic
- ✅ COMPLETED: Update database/repository to stop tracking relationship statistics
- ✅ COMPLETED: Test settings page layout and functionality after changes

**Phase 2 Status**: All implementation tasks completed successfully. Build and lint checks pass successfully. User verified and approved as completed.

#### Technical Implementation Details
**Layout Changes:**
- Reorder sections: Data Management → Data Overview → App Information
- Remove relationship statistics UI components and data bindings
- Remove backup-related UI elements
- Add new app information display section

**Data Layer Changes:**
- Remove relationship statistics calculations from database queries
- Update statistics repository to exclude relationship data
- Clean up any unused statistics tracking code

**App Information Display:**
- App Name: "Singventory"
- Owner: "PSED Development"
- Build Version: Display from BuildConfig (versionName + versionCode)

#### Implementation Notes - COMPLETED
**Layout Reorganization:** ✅
- Successfully moved Data Management card to top position in Settings page
- Data Overview card moved to middle position with cleaned up content
- New App Information card added at bottom with app name, developer, and version details

**Relationship Statistics Removal:** ✅
- Removed "Relationship Statistics" title and averages display from Data Overview
- Updated DataStatistics data class to remove songsPerVenueAverage and venuesPerSongAverage fields
- Removed relationship statistics calculation logic from SettingsViewModel.loadDataStatistics()
- Cleaned up unused calculation methods in ViewModel

**Backup Features Removal:** ✅
- Removed backup recommendation TextView and MaterialButton from layout
- Removed updateBackupRecommendation() method from SettingsFragment
- Removed backup button click listener from setupButtons()
- Removed BackupRecommendation and BackupUrgency enums from ViewModel
- Removed calculateBackupRecommendation() method from ViewModel

**App Information Display:** ✅
- Added new App Information card with clean Material Design 3 styling
- Display shows: "App: Singventory", "Developer: PSED Development", "Version: 0.0.1 (1)"
- Version information dynamically pulled from BuildConfig.VERSION_NAME and BuildConfig.VERSION_CODE
- Proper text styling and spacing matching existing design patterns

#### User Experience Improvements
**Simplified Settings Page:** ✅
- Cleaner, more focused Settings page without unnecessary backup reminders
- Data Management actions prominently displayed at top for easy access
- Essential data overview information clearly visible without statistical clutter
- App information readily available for support and version reference

**Better Information Hierarchy:** ✅
- Primary actions (Import/Export, Purge Data, Configuration) are first
- Core data counts (Songs, Venues, Visits, Performances, Associations) follow
- App identification information available at bottom
- Eliminated redundant relationship statistics that provided limited user value

#### Next Steps
[Phase 2 implementation complete - ready for user verification]

### Phase 3 - Minor Key Support Enhancement
**Status:** ❌ TODO  
**Priority:** Medium  
**Description:** Expand key selection system to include minor keys alongside major keys for comprehensive musical key support

#### Phase Progress
**Phase 3 Minor Key Support Implementation:**
- ❌ TODO: Extend MusicalKey enum to include all minor keys (Am, A#m/Bbm, Bm, Cm, etc.)
- ❌ TODO: Update key selection dropdowns to display both major and minor keys
- ❌ TODO: Organize key dropdown display: Major keys (C, C#/Db, D...) followed by Minor keys (Am, A#m/Bbm, Bm...)
- ❌ TODO: Update Add Song page key dropdowns to include minor key options
- ❌ TODO: Update Edit Song page key dropdowns to include minor key options
- ❌ TODO: Update Association Details Dialog key dropdown to include minor key options
- ❌ TODO: Update all key calculation logic to handle minor key relationships
- ❌ TODO: Ensure key adjustment calculations work correctly with minor keys
- ❌ TODO: Test key display formatting throughout the app with minor keys
- ❌ TODO: Update key adjustment display in song selection and performance logging

#### Technical Implementation Details
**MusicalKey Enum Enhancement:**
- Expand from 12 major keys to 24 keys total (12 major + 12 minor)
- Maintain enharmonic naming: C#/Db, D#/Eb, F#/Gb, G#/Ab, A#/Bb for both major and minor
- Minor key naming convention: Am, A#m/Bbm, Bm, Cm, C#m/Dbm, Dm, D#m/Ebm, Em, Fm, F#m/Gbm, Gm, G#m/Abm

**Key Selection UI Updates:**
- Display order: All major keys first (C through B), then all minor keys (Am through G#m/Abm)
- Consistent formatting across all key selection dropdowns
- Clear visual separation between major and minor key sections

**Key Calculation Logic:**
- Ensure key adjustment calculations maintain accuracy with minor keys
- Update semitone relationships to handle minor key intervals correctly
- Preserve existing major key functionality while adding minor key support

**Display Integration:**
- Song selection shows minor keys in parenthetical format: "Song Name - Artist (Fm)"
- Performance logging displays minor key adjustments: "Venue Adjustment: +2 steps (to Gm)"
- Association details capture and display minor key information accurately

#### User Scenarios Addressed
**Enhanced Musical Flexibility:**
- User discovers venue plays song in F minor → can select Fm from key dropdown
- User prefers singing certain songs in minor keys → can set preferred key as minor
- Venue-specific key adjustments work correctly with minor keys: "Venue: Am, You prefer: Dm (+5 steps)"

**Complete Key Coverage:**
- Classical and jazz standards often in minor keys can be properly cataloged
- Rock and pop songs with minor key sections receive accurate key tracking
- User can distinguish between major and minor versions of same root note (C vs Cm)

#### Next Steps
[Implementation pending user authorization]

### Phase 4 - Performance Deletion Bug Fix
**Status:** ❌ TODO  
**Priority:** High  
**Description:** Fix performance deletion functionality where deleted performances remain visible in visit performance lists

#### Phase Progress
**Phase 4 Performance Deletion Bug Fix Implementation:**
- ❌ TODO: Investigate performance deletion workflow in PerformanceEditFragment
- ❌ TODO: Verify delete performance database operation is executing correctly
- ❌ TODO: Check if VisitDetailsFragment performance list is refreshing after deletion
- ❌ TODO: Examine LiveData/StateFlow updates in VisitDetailsViewModel after performance deletion
- ❌ TODO: Test performance deletion from both VisitDetailsFragment and PerformanceEditFragment
- ❌ TODO: Verify deleted performance is removed from database queries
- ❌ TODO: Ensure performance statistics are updated correctly after deletion
- ❌ TODO: Fix any UI refresh issues preventing performance list updates
- ❌ TODO: Test performance deletion with various visit states (active vs completed)
- ❌ TODO: Verify navigation behavior after performance deletion

#### Technical Investigation Areas
**Database Operation Verification:**
- Confirm SingventoryRepository.deletePerformanceWithStats() is called correctly
- Verify PerformanceDao.delete() operation is executing and committing
- Check if foreign key constraints are preventing deletion
- Ensure database transaction completion before UI updates

**UI Refresh and Data Binding:**
- Investigate VisitDetailsViewModel.performances StateFlow updates
- Verify PerformancesAdapter is observing data changes correctly
- Check if adapter.notifyDataSetChanged() or DiffUtil updates are needed
- Ensure LiveData/StateFlow observers are properly connected

**Navigation and Lifecycle Issues:**
- Verify fragment lifecycle during performance deletion
- Check if navigation back to VisitDetailsFragment triggers data refresh
- Ensure ViewModel survives navigation transitions
- Test performance deletion in different app states

**Statistics Consistency:**
- Verify song.totalPerformances decrements correctly
- Check venue performance count updates
- Ensure SongVenueInfo.performanceCount decreases appropriately
- Confirm last performed dates update when applicable

#### User Scenarios Affected
**Performance Management Workflow:**
- User views visit details → selects performance → deletes performance → expects it removed from list
- User deletes multiple performances from same visit → all should be removed from display
- User deletes performance then navigates away and back → deletion should persist

**Data Consistency Issues:**
- Deleted performances showing in visit performance lists causes confusion
- Performance counts may be inaccurate if deletion doesn't update statistics
- User cannot trust the performance management interface if deletions don't work

#### Expected Behavior After Fix
- Performance disappears immediately from visit performance list after deletion
- Performance counts update correctly throughout the app
- Navigation flow works smoothly after performance deletion
- Database consistency maintained across all related entities

#### Next Steps
[Implementation pending user authorization]

### Phase 5 - Visit Performance Count Display Bug Fix
**Status:** ❌ TODO  
**Priority:** High  
**Description:** Fix incorrect performance count display on Your Visits page where visits show 0 performances despite having actual performances when viewed in visit details

#### Phase Progress
**Phase 5 Visit Performance Count Bug Fix Implementation:**
- ❌ TODO: Investigate VisitsAdapter performance count display logic
- ❌ TODO: Verify database query for visit performance counts in VisitsFragment/ViewModel
- ❌ TODO: Check if Visit entity includes performance count calculation
- ❌ TODO: Examine repository method for getting visits with performance counts
- ❌ TODO: Test visit performance count calculation after adding performances
- ❌ TODO: Verify performance count updates when visit status changes (active to completed)
- ❌ TODO: Check if performance count query includes proper JOIN or subquery
- ❌ TODO: Ensure performance count displays correctly for both active and completed visits
- ❌ TODO: Test performance count accuracy with multiple performances per visit
- ❌ TODO: Verify performance count updates in real-time during visit management

#### Technical Investigation Areas
**Database Query Analysis:**
- Verify VisitDao query includes performance count calculation
- Check if getAllVisits() or getAllVisitsWithPerformances() is being used
- Ensure proper LEFT JOIN or COUNT subquery for performance aggregation
- Confirm performance count calculation excludes deleted performances

**Visit Entity and Data Class Issues:**
- Check if Visit entity includes performanceCount field or if calculated dynamically
- Verify VisitWithPerformances or similar data class is used for display
- Ensure repository returns complete visit data including performance counts
- Check if performance count field is properly mapped in database queries

**UI Data Binding Problems:**
- Investigate VisitsAdapter binding logic for performance count display
- Verify correct data field is being displayed in visit list items
- Check if adapter is receiving complete visit data with performance counts
- Ensure layout file displays correct performance count field

**Real-time Update Issues:**
- Verify performance count updates when performances are added/removed
- Check if VisitsFragment observes performance changes correctly
- Ensure StateFlow/LiveData emissions include updated performance counts
- Confirm visit list refreshes when returning from visit details

#### User Scenarios Affected
**Visit Management Workflow:**
- User creates visit → adds performance → ends visit → expects accurate count on visits list
- User views visits list → sees incorrect 0 performances → loses confidence in data accuracy
- User compares visits list count vs visit details count → finds inconsistency

**Data Trust Issues:**
- Performance count discrepancy creates confusion about actual visit activity
- User cannot rely on visits list for quick performance count reference
- Incorrect counts affect visit history review and planning

#### Expected Behavior After Fix
- Visits list displays accurate performance count matching visit details
- Performance count updates immediately when performances are added/removed
- Count remains consistent between visits list and visit details views
- Both active and completed visits show correct performance counts

#### Likely Root Causes to Investigate
**Database Query Issues:**
- Missing performance count in visit query
- Incorrect JOIN conditions in visit/performance relationship
- Performance count not calculated or returned by repository

**Data Mapping Problems:**
- Visit adapter displaying wrong field for performance count
- Repository not providing performance count data
- ViewModel not exposing correct performance count information

#### Next Steps
[Implementation pending user authorization]

### Phase 6 - Visit Deletion Statistics Update Bug Fix
**Status:** ❌ TODO  
**Priority:** High  
**Description:** Fix statistics not updating when visits are deleted - visit counts and song performance counts should decrease when a visit and its performances are deleted

#### Phase Progress
**Phase 6 Visit Deletion Statistics Bug Fix Implementation:**
- ❌ TODO: Investigate visit deletion workflow in VisitsFragment/VisitsAdapter
- ❌ TODO: Verify if visit deletion includes cascading performance deletion
- ❌ TODO: Check if deleteVisit operation updates related statistics counters
- ❌ TODO: Examine venue visit count updates when visit is deleted
- ❌ TODO: Verify song performance count decrements when performances are deleted with visit
- ❌ TODO: Check SongVenueInfo performance count updates during visit deletion
- ❌ TODO: Ensure last performed dates are recalculated after visit deletion
- ❌ TODO: Test visit deletion statistics updates in Settings page data overview
- ❌ TODO: Verify database cascading deletes work correctly for Visit → Performance relationship
- ❌ TODO: Create comprehensive deleteVisitWithStats repository method

#### Technical Investigation Areas
**Visit Deletion Workflow:**
- Verify if deleteVisit() method exists and handles cascading deletions
- Check if visit deletion properly removes associated performances
- Ensure database foreign key constraints handle CASCADE deletes correctly
- Confirm visit deletion updates venue.totalVisits counter

**Performance Deletion Cascading:**
- Investigate if performances are deleted when parent visit is deleted
- Verify performance deletion triggers statistics updates
- Check if song.totalPerformances decrements for each deleted performance
- Ensure SongVenueInfo.performanceCount updates correctly

**Statistics Recalculation:**
- Verify venue statistics update when visit is deleted
- Check if song performance counts decrement appropriately  
- Ensure last performed dates are recalculated if most recent performance deleted
- Confirm Settings page counters reflect accurate data after deletions

**Repository Method Enhancement:**
- Create deleteVisitWithStats() method similar to deletePerformanceWithStats()
- Implement atomic transaction for visit deletion with statistics updates
- Ensure proper error handling during complex deletion operations
- Add logging for debugging statistics update issues

#### User Scenarios Affected
**Visit Management Workflow:**
- User creates visit → adds performance → ends visit → deletes visit → expects all counters to decrease
- User checks Settings page after visit deletion → expects accurate visit/performance counts
- User reviews song statistics → expects performance count to reflect deleted visit performances

**Data Integrity Issues:**
- Statistics become inflated over time if deletions don't update counters
- User loses trust in data accuracy when counts don't match reality
- Settings page data overview shows incorrect totals after deletions

#### Expected Behavior After Fix
**Immediate Statistics Updates:**
- Visit deletion decrements venue.totalVisits by 1
- Each performance in deleted visit decrements song.totalPerformances
- SongVenueInfo.performanceCount decreases for venue-specific performances
- Settings page counters update immediately after visit deletion

**Date Recalculation:**
- If deleted visit contained most recent performance, lastPerformed dates recalculate
- Venue.lastVisited updates to next most recent visit if deleted visit was most recent
- Song performance history remains accurate after visit deletion

#### Likely Implementation Approach
**Enhanced Repository Method:**
```kotlin
suspend fun deleteVisitWithStats(visit: Visit) {
    // 1. Get all performances for this visit
    // 2. Delete visit (cascade deletes performances)
    // 3. Decrement venue.totalVisits
    // 4. For each performance: decrement song.totalPerformances
    // 5. Update SongVenueInfo performance counts
    // 6. Recalculate lastPerformed/lastVisited dates
}
```

**Database Transaction Requirements:**
- All operations must be atomic to prevent data inconsistency
- Proper error handling if any statistics update fails
- Rollback capability if deletion partially completes

#### Root Cause Analysis
**Missing Statistics Updates:**
- Visit deletion likely only removes visit record, not updating counters
- No cascading statistics updates when performances are deleted
- Repository missing deleteVisitWithStats equivalent method

**Database Design Issues:**
- Foreign key constraints may not trigger statistics updates
- Statistics calculation may rely on manual updates rather than triggers
- Missing transaction boundaries for complex deletion operations

#### Next Steps
[Implementation pending user authorization]

## Cycle Notes
- This cycle represents a shift from feature development to quality assurance
- Focus on user experience and stability rather than new functionality
- Bug discoveries will inform priorities for future development cycles
- Comprehensive testing approach ensures reliability before potential release

## Future Cycles
Based on bugs discovered in this cycle:
- DevCycle 2025-0007: Critical bug fixes and stability improvements
- DevCycle 2025-0008: UI/UX enhancements and usability improvements
- DevCycle 2025-0009: Performance optimizations and edge case handling
- DevCycle 2025-0010: Feature refinements based on testing insights

## Cycle Completion Summary
*[To be added when cycle is completed]*