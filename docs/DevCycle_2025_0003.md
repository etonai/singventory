# Development Cycle 2025-0003

**Status:** In Progress  
**Start Date:** 2025-08-06  
**Target Completion:** TBD  
**Focus:** Core UI layer implementation with essential screens and navigation for Singventory user scenarios

## Overview
This development cycle focuses on implementing the foundational UI layer that enables users to interact with the robust database architecture completed in DevCycle 2. The goal is to create the essential screens and workflows that support the three key user scenarios identified in `docs/Initial_Singventory_Design.md`: impromptu visits, recon visits, and repeat visits. Following PlayStreak's proven MVVM + ViewBinding patterns, this cycle will establish the core navigation and CRUD functionality needed for a functional karaoke tracking app.

## Current Work Items

### Phase 1 - Main Activity and Navigation Setup
**Status:** ‚úÖ Completed  
**Priority:** Critical  
**Description:** Implement MainActivity with bottom navigation and fragment management following PlayStreak's navigation architecture

#### Phase Progress
**Phase Navigation:**
- ‚úÖ COMPLETED: Create MainActivity with bottom navigation (4 tabs: Songs, Venues, Visits, Settings)
- ‚úÖ COMPLETED: Implement Navigation Component setup following PlayStreak patterns
- ‚úÖ COMPLETED: Create base fragments for each main tab
- ‚úÖ COMPLETED: Add Material Design 3 theming with music-themed adaptations
- ‚úÖ COMPLETED: Implement fragment lifecycle management and state preservation

#### Technical Implementation Details
**Complete Navigation Layer Implemented:**
- **MainActivity**: Full Navigation Component integration with AppBarConfiguration for 4 top-level destinations
- **Bottom Navigation**: Material Design 3 BottomNavigationView with custom music-themed icons and colors
- **Fragment Management**: ViewBinding-based fragments with proper lifecycle and state preservation
- **Navigation Graph**: Complete nav_graph.xml with all 4 main destinations configured
- **State Preservation**: MainActivity saves/restores selected tab, all fragments preserve scroll positions and search queries
- **Material Design 3**: Complete theme system with musical purple/gold color palette for light and dark modes
- **Fragment Structure**: SongsFragment, VenuesFragment, VisitsFragment, SettingsFragment all with empty state handling

**Key Features Implemented:**
- Proper fragment lifecycle management with onSaveInstanceState/restoreState patterns
- SearchBar components ready for Phase 2 implementation
- FAB buttons positioned and configured for CRUD operations
- Settings screen with data count display following PlayStreak pattern
- Music-themed color system with primary purple (#6B3BA0) and secondary gold (#D4AF37)
- Complete ViewBinding setup with proper null safety patterns

#### Issues Identified During User Testing
**Status:** üîç Requires Resolution  

**Issue 1: Status Bar Icons Visibility in Light Mode**
- **Problem**: Time, Wi-Fi signal strength, and battery icons are not visible in light mode
- **Observation**: Icons are visible in dark mode, indicating theme color application issue
- **Root Cause**: App not properly handling system bar colors for light/dark theme switching
- **Impact**: Poor user experience in light mode - critical system information hidden
- **‚úÖ FIXED**: Added proper system UI color configuration to both light and dark themes
  - Light theme: `android:windowLightStatusBar="true"` with white status bar background
  - Dark theme: `android:windowLightStatusBar="false"` with dark status bar background
  - Navigation bar colors also configured for consistency

**Issue 2: Content Layout Overlapping Status Bar (SDK 35/36 Edge-to-Edge)**
- **Problem**: Fragment content is drawing behind/above the action bar and status bar area
- **Symptoms**: 
  - Songs page: "No songs yet..." content starts above "Your Songs" title bar
  - Settings page: Data overview card has top border intersecting with time/signal icons
  - **Detailed Settings Issue**: The section displaying "Songs, Venues, Visits, Performances" is positioned incorrectly - it starts at the very top of the page (pixel just under the status bar icons) instead of properly starting below the "Settings" title bar
- **Root Cause**: Edge-to-edge layout enforcement in SDK 35/36 without proper window insets handling
- **Technical Analysis**: The app layout assumes content starts below the action bar, but edge-to-edge mode causes content to draw under the system UI
- **Comparison**: Similar issues encountered in PlayStreak project with modern Android versions
- **Impact**: Content obscured by system UI, poor visual hierarchy, unusable interface elements
- **‚úÖ FIXED**: Implemented proper edge-to-edge WindowInsets handling with general solution
  - `enableEdgeToEdge()` in MainActivity for modern Android SDK 35/36 compatibility
  - `ViewCompat.setOnApplyWindowInsetsListener()` to handle system bar insets properly
  - Applied top insets to navigation host fragment (all fragments benefit automatically)
  - Applied bottom insets to bottom navigation for consistent padding
  - Status/navigation bars now transparent with proper content positioning
  - Single implementation in MainActivity fixes all current and future fragments

**Technical Analysis:**
- Modern Android (API 35/36) enforces edge-to-edge display by default
- App requires proper WindowInsets handling and system bar color management
- Material Design 3 theme may need adjustment for system UI integration
- Status bar content color needs dynamic adjustment based on theme

#### Resolution Status
‚úÖ **Both critical UI issues have been resolved:**

**Issue 1 Resolution:**
- Status bar icons now properly visible in both light and dark modes
- Proper theme color configuration ensures system UI legibility

**Issue 2 Resolution:**  
- Edge-to-edge layout properly implemented with WindowInsets handling
- All fragments now correctly positioned below system UI areas
- Settings page data overview section properly positioned below title bar
- Future-proof solution works for all current and future fragments

#### Next Steps
- Verify fixes work correctly across different screen sizes and orientations
- Test edge cases like split-screen mode and different system UI configurations
- Phase 1 ready for final verification with both critical issues resolved

### Phase 2 - Songs and Venues CRUD Screens
**Status:** ‚úÖ Completed  
**Priority:** High  
**Description:** Implement core CRUD functionality for songs and venues with search/filter capabilities

#### Phase Progress
**Phase CRUD Implementation:**
- ‚úÖ COMPLETED: Create SongsFragment with RecyclerView following PlayStreak's list patterns
- ‚úÖ COMPLETED: Implement AddSongFragment with form validation and key input support
- ‚úÖ COMPLETED: Create VenuesFragment with venue list and search functionality
- ‚úÖ COMPLETED: Implement AddVenueFragment with venue information input
- ‚úÖ COMPLETED: Add floating action buttons for quick addition workflow
- ‚úÖ COMPLETED: Implement search functionality prioritizing frequently performed songs
- ‚ùå DEFERRED: Create song-venue association screens for adding venues to existing songs (advanced feature for future cycle)

#### Technical Implementation Details
**Complete Songs CRUD System:**
- **SongsFragment**: RecyclerView with SongsAdapter, MVVM architecture, state preservation, empty state handling
- **SongsAdapter**: DiffUtil-based adapter with song information display, venue association buttons, performance metrics
- **SongsViewModel**: Repository integration, search functionality with StateFlow, prioritizes frequently performed songs
- **AddSongFragment**: Form validation, musical key dropdown support (MusicalKey enum), Material Design 3 cards layout
- **AddSongViewModel**: Full form state management, song creation with optional fields (artist made optional for quick entry)
- **Navigation**: Complete navigation graph integration with action-based transitions

**Complete Venues CRUD System:**
- **VenuesFragment**: RecyclerView with VenuesAdapter, MVVM architecture, state preservation, empty state handling  
- **VenuesAdapter**: DiffUtil-based adapter with venue information display, song association buttons, visit count metrics
- **VenuesViewModel**: Repository integration, search functionality with StateFlow, prioritizes frequently visited venues
- **AddVenueFragment**: Comprehensive venue form with room type dropdown, optional fields (address, cost, hours, notes)
- **AddVenueViewModel**: Full form state management, venue creation with proper field validation
- **Navigation**: Complete navigation graph integration with action-based transitions

**Architecture Patterns Implemented:**
- **MVVM + Repository**: Full separation of concerns following PlayStreak architecture patterns
- **ViewBinding**: Type-safe view access across all fragments and adapters
- **StateFlow**: Reactive state management for form inputs, search queries, and UI updates
- **Room Integration**: Proper repository constructor pattern with individual DAO injection
- **Navigation Component**: Action-based navigation with proper back stack management
- **Lifecycle Management**: ViewLifecycleOwner-aware coroutines, state preservation, proper cleanup

**User Experience Optimizations:**
- **Quick Song Entry**: Artist field made optional per user request - users can add just song name and complete details later
- **Material Design 3**: Consistent card-based layouts, proper form structure, extended FABs
- **Search & Sorting**: PlayStreak-inspired prioritization of frequently performed/visited items
- **Form Validation**: Real-time validation with error clearing, comprehensive field support
- **State Preservation**: Search queries, scroll positions preserved across configuration changes

**Musical Features Implemented:**
- **MusicalKey Support**: Full dropdown selection with all major/minor keys, optional reference/preferred key tracking
- **Performance Metrics**: Song and venue adapters display performance/visit counts following PlayStreak patterns
- **Key Management**: Optional key information that can be added later, supports both reference and preferred keys

#### User-Requested Modifications
**Artist Field Made Optional (Phase 2 Adjustment):**
- Modified AddSongFragment layout hint to "Artist (Optional)"
- Updated AddSongViewModel validation to allow empty artist field  
- Modified SongsAdapter to display "Artist not specified" for songs without artist information
- **Rationale**: Enable rapid song entry during live karaoke scenarios - users can add essential song information immediately and complete details later

#### Next Steps  
**Phase 2 Complete - Ready for Phase 3:**
- All core CRUD functionality implemented and tested
- Navigation workflows fully functional between list and add screens
- Search and sorting algorithms prioritize user engagement patterns
- Song-venue association feature deferred to future cycle (advanced relationship management)

### Phase 3 - Visit Management and Performance Logging
**Status:** üìã Open  
**Priority:** High  
**Description:** Implement visit creation, performance logging, and key adjustment workflows for live karaoke scenarios

#### Phase Progress
**Phase Visit Workflows:**
- ‚ùå TODO: Create VisitsFragment showing recent and active visits
- ‚ùå TODO: Implement StartVisitFragment with venue selection and auto-complete
- ‚ùå TODO: Create ActiveVisitFragment for live performance logging during karaoke sessions
- ‚ùå TODO: Implement quick performance entry with minimal tap requirements
- ‚ùå TODO: Add key adjustment interface supporting both dropdown and step-based input
- ‚ùå TODO: Create visit completion workflow with explicit end/reopen capability
- ‚ùå TODO: Implement performance notes entry (optional immediate, can add later)

#### Technical Implementation Details
*To be documented as visit management features are implemented*

#### Next Steps
- Focus on speed of performance logging for live use
- Support all three user scenarios from design document
- Integrate musical key management system from DevCycle 2

## Cycle Notes
- Building on complete database architecture from DevCycle 2
- Following PlayStreak's proven UI patterns and fragment management
- Implementing offline-first design for poor connectivity at karaoke venues
- Supporting all user scenarios from Initial_Singventory_Design.md
- Material Design 3 with music-themed adaptations as specified in design

## Future Cycles

### Deferred Phase 2 Features
**Song-Venue Association Screens:**
- **Status**: Deferred to future development cycle  
- **Full Documentation**: See `docs/Deferred_Features.md` for complete technical requirements and implementation details
- **Priority**: Medium-High
- **Rationale**: Advanced relationship management feature deferred to focus on core CRUD functionality
- **Next Steps**: Feature tracked in persistent deferred features document for future cycle planning

### Other Future Features
- Settings screen with data counters (following PlayStreak patterns)
- Import/Export functionality (direct copy from PlayStreak)
- Purge data functionality with stats preservation
- Advanced features like analytics and search enhancements
- Song editing and venue editing screens (update CRUD operations)
- Advanced search filters (by key, performance frequency, venue association)
- Bulk operations for song and venue management

## Cycle Completion Summary
*[To be added when cycle is completed]*

## Design Document Reference
This implementation directly supports the user scenarios outlined in `docs/Initial_Singventory_Design.md`:

**Impromptu Visit Scenario (Lines 82-94):**
- Quick venue creation with minimal required information
- Song-venue association through "add venue" icon workflow
- Performance logging with optional notes ("too high", "too low", "just right")
- Rapid workflow for friends and social karaoke situations

**Recon Visit Scenario (Lines 95-110):**
- Pre-visit venue setup with full information entry
- Song candidate addition before visiting venue
- Venue song ID entry for preparation
- Post-visit key information and preference updates

**Repeat Visit Scenario (Lines 111-122):**
- Quick venue selection for known locations
- Display of researched songs with key information and frequency indicators
- Performance entry showing venue song IDs and key adjustments
- Visit completion with notes about cost, duration, companions

**Key Requirements from Design Document:**
- Bottom navigation: Songs, Venues, Visits, Settings (PlayStreak pattern)
- Quick performance logging optimized for live karaoke use
- Dual key input methods: dropdown selection AND step adjustments
- Search prioritizing frequently performed songs
- Offline-first operation for venues with poor connectivity
- Visit auto-save after each performance entry
- Explicit visit end/reopen capability