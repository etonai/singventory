# Development Cycle 2025-0003

**Status:** In Progress  
**Start Date:** 2025-08-06  
**Target Completion:** TBD  
**Focus:** Core UI layer implementation with essential screens and navigation for Singventory user scenarios

## Overview
This development cycle focuses on implementing the foundational UI layer that enables users to interact with the robust database architecture completed in DevCycle 2. The goal is to create the essential screens and workflows that support the three key user scenarios identified in `docs/Initial_Singventory_Design.md`: impromptu visits, recon visits, and repeat visits. Following PlayStreak's proven MVVM + ViewBinding patterns, this cycle will establish the core navigation and CRUD functionality needed for a functional karaoke tracking app.

## Current Work Items

### Phase 1 - Main Activity and Navigation Setup
**Status:** ‚úÖ Completed  
**Priority:** Critical  
**Description:** Implement MainActivity with bottom navigation and fragment management following PlayStreak's navigation architecture

#### Phase Progress
**Phase Navigation:**
- ‚úÖ COMPLETED: Create MainActivity with bottom navigation (4 tabs: Songs, Venues, Visits, Settings)
- ‚úÖ COMPLETED: Implement Navigation Component setup following PlayStreak patterns
- ‚úÖ COMPLETED: Create base fragments for each main tab
- ‚úÖ COMPLETED: Add Material Design 3 theming with music-themed adaptations
- ‚úÖ COMPLETED: Implement fragment lifecycle management and state preservation

#### Technical Implementation Details
**Complete Navigation Layer Implemented:**
- **MainActivity**: Full Navigation Component integration with AppBarConfiguration for 4 top-level destinations
- **Bottom Navigation**: Material Design 3 BottomNavigationView with custom music-themed icons and colors
- **Fragment Management**: ViewBinding-based fragments with proper lifecycle and state preservation
- **Navigation Graph**: Complete nav_graph.xml with all 4 main destinations configured
- **State Preservation**: MainActivity saves/restores selected tab, all fragments preserve scroll positions and search queries
- **Material Design 3**: Complete theme system with musical purple/gold color palette for light and dark modes
- **Fragment Structure**: SongsFragment, VenuesFragment, VisitsFragment, SettingsFragment all with empty state handling

**Key Features Implemented:**
- Proper fragment lifecycle management with onSaveInstanceState/restoreState patterns
- SearchBar components ready for Phase 2 implementation
- FAB buttons positioned and configured for CRUD operations
- Settings screen with data count display following PlayStreak pattern
- Music-themed color system with primary purple (#6B3BA0) and secondary gold (#D4AF37)
- Complete ViewBinding setup with proper null safety patterns

#### Issues Identified During User Testing
**Status:** üîç Requires Resolution  

**Issue 1: Status Bar Icons Visibility in Light Mode**
- **Problem**: Time, Wi-Fi signal strength, and battery icons are not visible in light mode
- **Observation**: Icons are visible in dark mode, indicating theme color application issue
- **Root Cause**: App not properly handling system bar colors for light/dark theme switching
- **Impact**: Poor user experience in light mode - critical system information hidden
- **‚úÖ FIXED**: Added proper system UI color configuration to both light and dark themes
  - Light theme: `android:windowLightStatusBar="true"` with white status bar background
  - Dark theme: `android:windowLightStatusBar="false"` with dark status bar background
  - Navigation bar colors also configured for consistency

**Issue 2: Content Layout Overlapping Status Bar (SDK 35/36 Edge-to-Edge)**
- **Problem**: Fragment content is drawing behind/above the action bar and status bar area
- **Symptoms**: 
  - Songs page: "No songs yet..." content starts above "Your Songs" title bar
  - Settings page: Data overview card has top border intersecting with time/signal icons
  - **Detailed Settings Issue**: The section displaying "Songs, Venues, Visits, Performances" is positioned incorrectly - it starts at the very top of the page (pixel just under the status bar icons) instead of properly starting below the "Settings" title bar
- **Root Cause**: Edge-to-edge layout enforcement in SDK 35/36 without proper window insets handling
- **Technical Analysis**: The app layout assumes content starts below the action bar, but edge-to-edge mode causes content to draw under the system UI
- **Comparison**: Similar issues encountered in PlayStreak project with modern Android versions
- **Impact**: Content obscured by system UI, poor visual hierarchy, unusable interface elements
- **‚úÖ FIXED**: Implemented proper edge-to-edge WindowInsets handling with general solution
  - `enableEdgeToEdge()` in MainActivity for modern Android SDK 35/36 compatibility
  - `ViewCompat.setOnApplyWindowInsetsListener()` to handle system bar insets properly
  - Applied top insets to navigation host fragment (all fragments benefit automatically)
  - Applied bottom insets to bottom navigation for consistent padding
  - Status/navigation bars now transparent with proper content positioning
  - Single implementation in MainActivity fixes all current and future fragments

**Technical Analysis:**
- Modern Android (API 35/36) enforces edge-to-edge display by default
- App requires proper WindowInsets handling and system bar color management
- Material Design 3 theme may need adjustment for system UI integration
- Status bar content color needs dynamic adjustment based on theme

#### Resolution Status
‚úÖ **Both critical UI issues have been resolved:**

**Issue 1 Resolution:**
- Status bar icons now properly visible in both light and dark modes
- Proper theme color configuration ensures system UI legibility

**Issue 2 Resolution:**  
- Edge-to-edge layout properly implemented with WindowInsets handling
- All fragments now correctly positioned below system UI areas
- Settings page data overview section properly positioned below title bar
- Future-proof solution works for all current and future fragments

#### Next Steps
- Verify fixes work correctly across different screen sizes and orientations
- Test edge cases like split-screen mode and different system UI configurations
- Phase 1 ready for final verification with both critical issues resolved

### Phase 2 - Songs and Venues CRUD Screens
**Status:** ‚úÖ Completed  
**Priority:** High  
**Description:** Implement core CRUD functionality for songs and venues with search/filter capabilities

#### Phase Progress
**Phase CRUD Implementation:**
- ‚úÖ COMPLETED: Create SongsFragment with RecyclerView following PlayStreak's list patterns
- ‚úÖ COMPLETED: Implement AddSongFragment with form validation and key input support
- ‚úÖ COMPLETED: Create VenuesFragment with venue list and search functionality
- ‚úÖ COMPLETED: Implement AddVenueFragment with venue information input
- ‚úÖ COMPLETED: Add floating action buttons for quick addition workflow
- ‚úÖ COMPLETED: Implement search functionality prioritizing frequently performed songs
- ‚ùå DEFERRED: Create song-venue association screens for adding venues to existing songs (advanced feature for future cycle)

#### Technical Implementation Details
**Complete Songs CRUD System:**
- **SongsFragment**: RecyclerView with SongsAdapter, MVVM architecture, state preservation, empty state handling
- **SongsAdapter**: DiffUtil-based adapter with song information display, venue association buttons, performance metrics
- **SongsViewModel**: Repository integration, search functionality with StateFlow, prioritizes frequently performed songs
- **AddSongFragment**: Form validation, musical key dropdown support (MusicalKey enum), Material Design 3 cards layout
- **AddSongViewModel**: Full form state management, song creation with optional fields (artist made optional for quick entry)
- **Navigation**: Complete navigation graph integration with action-based transitions

**Complete Venues CRUD System:**
- **VenuesFragment**: RecyclerView with VenuesAdapter, MVVM architecture, state preservation, empty state handling  
- **VenuesAdapter**: DiffUtil-based adapter with venue information display, song association buttons, visit count metrics
- **VenuesViewModel**: Repository integration, search functionality with StateFlow, prioritizes frequently visited venues
- **AddVenueFragment**: Comprehensive venue form with room type dropdown, optional fields (address, cost, hours, notes)
- **AddVenueViewModel**: Full form state management, venue creation with proper field validation
- **Navigation**: Complete navigation graph integration with action-based transitions

**Architecture Patterns Implemented:**
- **MVVM + Repository**: Full separation of concerns following PlayStreak architecture patterns
- **ViewBinding**: Type-safe view access across all fragments and adapters
- **StateFlow**: Reactive state management for form inputs, search queries, and UI updates
- **Room Integration**: Proper repository constructor pattern with individual DAO injection
- **Navigation Component**: Action-based navigation with proper back stack management
- **Lifecycle Management**: ViewLifecycleOwner-aware coroutines, state preservation, proper cleanup

**User Experience Optimizations:**
- **Quick Song Entry**: Artist field made optional per user request - users can add just song name and complete details later
- **Material Design 3**: Consistent card-based layouts, proper form structure, extended FABs
- **Search & Sorting**: PlayStreak-inspired prioritization of frequently performed/visited items
- **Form Validation**: Real-time validation with error clearing, comprehensive field support
- **State Preservation**: Search queries, scroll positions preserved across configuration changes

**Musical Features Implemented:**
- **MusicalKey Support**: Full dropdown selection with all major/minor keys, optional reference/preferred key tracking
- **Performance Metrics**: Song and venue adapters display performance/visit counts following PlayStreak patterns
- **Key Management**: Optional key information that can be added later, supports both reference and preferred keys

#### User-Requested Modifications
**Artist Field Made Optional (Phase 2 Adjustment):**
- Modified AddSongFragment layout hint to "Artist (Optional)"
- Updated AddSongViewModel validation to allow empty artist field  
- Modified SongsAdapter to display "Artist not specified" for songs without artist information
- **Rationale**: Enable rapid song entry during live karaoke scenarios - users can add essential song information immediately and complete details later

#### Next Steps  
**Phase 2 Complete - Ready for Phase 3:**
- All core CRUD functionality implemented and tested
- Navigation workflows fully functional between list and add screens
- Search and sorting algorithms prioritize user engagement patterns
- Song-venue association feature deferred to future cycle (advanced relationship management)

### Phase 3 - Visit Management and Performance Logging
**Status:** ‚úÖ Completed  
**Priority:** High  
**Description:** Implement visit creation, performance logging, and key adjustment workflows for live karaoke scenarios

#### Phase Progress
**Phase Visit Workflows:**
- ‚úÖ COMPLETED: Create VisitsFragment showing recent and active visits with RecyclerView
- ‚úÖ COMPLETED: Implement StartVisitFragment with venue selection and auto-complete
- ‚úÖ COMPLETED: Create ActiveVisitFragment for live performance logging during karaoke sessions
- ‚úÖ COMPLETED: Implement quick performance entry with minimal tap requirements
- ‚úÖ COMPLETED: Add key adjustment interface supporting both dropdown and step-based input
- ‚úÖ COMPLETED: Create visit completion workflow with explicit end/reopen capability
- ‚úÖ COMPLETED: Implement performance notes entry (optional immediate, can add later)

#### Technical Implementation Details
**Complete Visit Management System:**
- **VisitsFragment**: RecyclerView with VisitsAdapter displaying recent and active visits, proper MVVM architecture
- **VisitsAdapter**: DiffUtil-based adapter with VisitWithDetails data class, venue name resolution, performance counting
- **VisitsViewModel**: Repository integration with visit data transformation, active visit tracking, end visit functionality
- **StartVisitFragment**: Venue selection with autocomplete, quick venue creation dialog, visit initialization workflow
- **StartVisitViewModel**: Venue search and creation, visit setup with optional notes, navigation to active session

**Core Live Performance Logging (ActiveVisitFragment):**
- **Optimized for Speed**: 3-tap workflow (Search ‚Üí Select ‚Üí "Just Sang It!") for minimal interruption during karaoke
- **Smart Song Search**: Autocomplete with partial matching, creates songs on-demand during live sessions
- **Performance History**: Real-time display of tonight's performances with timestamps, key adjustments, and notes
- **Quick Logging Options**: 
  - Instant "Just Sang It!" button for ultra-fast entry
  - "With Notes..." option for detailed logging with key adjustments and performance notes
  - Quick song creation dialog for new songs discovered during visits
- **Visit Management**: End visit workflow with confirmation, duration tracking, performance statistics
- **Material Design**: BottomAppBar with FAB, card-based layout optimized for one-handed phone use during karaoke

**Performance Entry Workflows:**
- **Minimal Tap Entry**: Type song name ‚Üí Select from autocomplete ‚Üí Tap "Just Sang It!" = Performance logged
- **Quick Creation**: Search non-existent song ‚Üí "Create & Log" ‚Üí Instantly adds song and logs performance  
- **Detailed Entry**: Access key adjustment (-3 to +3 steps) and performance notes ("too high", "too low", "just right")
- **Smart Autocomplete**: Prioritizes frequently performed songs, includes artist information in search results

**Architecture Patterns:**
- **MVVM + Repository**: Full separation of concerns with complex data relationships (Visit ‚Üí Performance ‚Üí Song ‚Üí Venue)
- **StateFlow & Coroutines**: Reactive real-time updates for performance list and visit statistics
- **Navigation Component**: Proper fragment transitions with visit ID argument passing
- **Data Transformation**: VisitWithDetails and PerformanceWithSong wrapper classes for display optimization
- **Error Handling**: Graceful handling of missing venues, duplicate songs, and network issues

**Database Integration:**
- **Complex Relationships**: Full Visit-Performance-Song-Venue association management
- **Performance Logging**: `repository.logPerformance()` with atomic operations and statistics updates
- **Visit Lifecycle**: Active visit tracking, end visit workflow, visit duration calculations
- **Real-time Updates**: Performance list updates immediately after logging, visit statistics refresh automatically

**User Experience Optimizations:**
- **Live Session Focus**: Designed specifically for active karaoke scenarios with poor lighting and distractions
- **One-Handed Operation**: FAB and bottom sheet interactions optimized for phone use while holding microphone
- **Visual Feedback**: Immediate snackbar confirmations, real-time performance count updates
- **Flexible Entry**: Supports both lightning-fast logging and detailed entry based on user preference
- **State Preservation**: Maintains active visit context, restores search queries, preserves performance history

#### User Scenario Support
**All Three Design Document Scenarios Fully Implemented:**

**Impromptu Visit Scenario:**
- ‚úÖ Quick venue creation with minimal information (name only)
- ‚úÖ Song discovery and instant addition during visit
- ‚úÖ Performance logging with optional notes ("too high", "too low", "just right")
- ‚úÖ Rapid workflow optimized for friends and social karaoke situations

**Recon Visit Scenario:**
- ‚úÖ Pre-visit venue setup with comprehensive information entry
- ‚úÖ Song research and candidate addition before visiting
- ‚úÖ Performance logging for testing songs and key adjustments
- ‚úÖ Visit completion with detailed notes and observations

**Repeat Visit Scenario:**
- ‚úÖ Quick venue selection from known locations with autocomplete
- ‚úÖ Display of researched songs with performance history and key information
- ‚úÖ Performance entry showing key adjustments and frequency indicators
- ‚úÖ Visit completion with cost tracking and companion notes

#### Completion Summary
**Phase 3 Successfully Completed:**
- ‚úÖ All core visit management functionality implemented and tested
- ‚úÖ Live performance logging system optimized for real karaoke venue usage
- ‚úÖ Complete support for all three user scenarios from design document
- ‚úÖ Navigation bug fixes and performance logging race condition resolved
- ‚úÖ User verification and approval received

**Key Bugs Fixed During Phase 3:**
- **Navigation Issue**: Fixed VisitsFragment navigation to ActiveVisitFragment (visitId argument passing)
- **Quick Song Entry Bug**: Resolved race condition where songs weren't appearing in Tonight's Performances list
- **Null Pointer Crash**: Fixed onSaveInstanceState crashes when switching tabs during visit creation

### Phase 4 - Songs Page Sorting and Organization
**Status:** ‚úÖ Completed  
**Priority:** Medium  
**Description:** Implement comprehensive sorting options for the Songs page to help users organize their song library effectively

#### Phase Progress
**Phase Sorting Implementation:**
- ‚úÖ COMPLETED: Add sorting options to Songs page (title, artist, performance count, last performance)
- ‚úÖ COMPLETED: Implement reverse sort order toggle for Songs page  
- ‚úÖ COMPLETED: Create sort menu/UI controls in SongsFragment
- ‚úÖ COMPLETED: Update SongsViewModel to handle sorting logic and state persistence

#### Technical Requirements
**Sorting Options to Implement:**
- **By Title (A-Z/Z-A)**: Alphabetical sorting of song names
- **By Artist (A-Z/Z-A)**: Alphabetical sorting of artist names
- **By Performance Count (Most/Least)**: Sort by total number of times performed
- **By Last Performance (Recent/Oldest)**: Sort by timestamp of most recent performance

**UI Components Needed:**
- **Sort Menu**: Overflow menu or bottom sheet with sorting options
- **Sort Indicator**: Visual indication of current sort order in UI
- **Reverse Toggle**: Icon or switch to reverse current sort order
- **State Persistence**: Remember user's preferred sorting across app sessions

**Architecture Implementation:**
- **SongsViewModel Enhancement**: Add sorting state management with StateFlow
- **Repository Extension**: Implement performance counting and last performance queries
- **Database Queries**: Create sorted queries in SongDao for performance-based sorting
- **UI State Management**: Preserve sort preferences and restore on fragment recreation

#### User Experience Goals
**Sorting Workflow:**
1. User taps sort icon/menu in Songs page
2. Select from 4 sorting options (Title, Artist, Performance Count, Last Performance)  
3. Toggle ascending/descending order with dedicated reverse button
4. Songs list updates immediately with visual feedback
5. Sort preference remembered across app sessions and device rotations

**PlayStreak Pattern Alignment:**
- Follow PlayStreak's sorting UI patterns for consistency
- Use Material Design 3 sort icons and menu components
- Implement similar state preservation and user preference management

#### Benefits for User Scenarios
**Enhanced Song Discovery:**
- **Alphabetical Sorting**: Quick finding of known songs by title or artist
- **Performance-Based Sorting**: Identify frequently sung favorites and neglected songs
- **Recent Activity Sorting**: See which songs were performed in recent visits

**Karaoke Session Optimization:**
- Sort by performance count to find proven crowd pleasers
- Sort by last performance to discover songs not sung recently
- Alphabetical sorting for quick lookup during venue visits

#### Completion Summary
**Phase 4 Successfully Completed:**
- ‚úÖ **SongSortOption Enum**: Created comprehensive enum with Title, Artist, Performance Count, and Last Performance options
- ‚úÖ **Enhanced SongsViewModel**: Added sorting state management with StateFlow and intelligent sort order defaults
- ‚úÖ **Advanced Sorting Logic**: Implemented case-insensitive alphabetical sorting and performance-based sorting with null handling
- ‚úÖ **Material Design 3 UI**: Created sort controls with icon buttons, popup menu, and visual sort direction indicators
- ‚úÖ **User Experience Optimizations**: Auto-adjusted default sort orders (A-Z for text, Most/Recent first for metrics)
- ‚úÖ **Real-time Updates**: Immediate list updates when sort options change with visual feedback

**Technical Implementation Details:**
- **Sort Controls**: Added sort menu button and sort direction toggle button in fragment header
- **Popup Menu**: Material Design sort option selection with single-choice checkable items
- **Icon Resources**: Created ascending/descending sort direction icons with proper Material theming
- **State Management**: Reactive sorting with combine() flow operators for efficient list updates
- **Smart Defaults**: Context-aware default sort orders (alphabetical ascending, metrics descending)
- **Reliable Scroll-to-Top**: Flag-based system with RecyclerView submitList callback ensures consistent scrolling behavior

**User Experience Enhancements:**
- **Automatic Scroll-to-Top**: When sort field or direction changes, list automatically scrolls to top to show newly organized results
- **Consistent Behavior**: Eliminates erratic scrolling by using data-driven callback approach
- **Visual Feedback**: Sort direction icons update immediately to reflect current sort order
- **Intuitive Controls**: Sort menu with clear option labels and toggle button for direction changes

### Phase 5 - Venues Page Sorting
**Status:** üöß Pending  
**Priority:** Medium  
**Description:** Implement venue title sorting for the Venues page to help users organize their venue library

#### Phase Progress
**Phase Venue Sorting Implementation:**
- ‚è≥ PENDING: Add venue title sorting to Venues page (A-Z/Z-A)
- ‚è≥ PENDING: Create sort toggle UI controls in VenuesFragment
- ‚è≥ PENDING: Update VenuesViewModel to handle venue sorting logic and state persistence

#### Technical Requirements
**Sorting Option to Implement:**
- **By Title (A-Z/Z-A)**: Alphabetical sorting of venue names with ascending/descending toggle

**UI Components Needed:**
- **Sort Toggle**: Simple A-Z/Z-A toggle button in toolbar or as floating action
- **Sort Indicator**: Visual indication of current sort order (ascending/descending)
- **State Persistence**: Remember user's preferred sorting across app sessions

**Architecture Implementation:**
- **VenuesViewModel Enhancement**: Add sorting state management with StateFlow
- **UI State Management**: Preserve sort preference and restore on fragment recreation
- **Database Query**: Utilize existing venue queries with ORDER BY clause

#### User Experience Goals
**Sorting Workflow:**
1. User taps sort toggle in Venues page (A-Z or Z-A icon)
2. Venues list updates immediately with alphabetical sorting
3. Sort preference remembered across app sessions and device rotations
4. Visual feedback shows current sort direction

**Benefits for User Scenarios:**
- **Quick Venue Discovery**: Easily find venues alphabetically during visit planning
- **Venue Organization**: Better organization of growing venue collections
- **Visit Planning**: Faster venue selection when starting new visits

## Cycle Notes
- Building on complete database architecture from DevCycle 2
- Following PlayStreak's proven UI patterns and fragment management
- Implementing offline-first design for poor connectivity at karaoke venues
- Supporting all user scenarios from Initial_Singventory_Design.md
- Material Design 3 with music-themed adaptations as specified in design

## Future Cycles

### Deferred Phase 2 Features
**Song-Venue Association Screens:**
- **Status**: Deferred to future development cycle  
- **Full Documentation**: See `docs/Deferred_Features.md` for complete technical requirements and implementation details
- **Priority**: Medium-High
- **Rationale**: Advanced relationship management feature deferred to focus on core CRUD functionality
- **Next Steps**: Feature tracked in persistent deferred features document for future cycle planning

### Other Future Features
- Settings screen with data counters (following PlayStreak patterns)
- Import/Export functionality (direct copy from PlayStreak)
- Purge data functionality with stats preservation
- Advanced features like analytics and search enhancements
- Song editing and venue editing screens (update CRUD operations)
- Advanced search filters (by key, performance frequency, venue association)
- Bulk operations for song and venue management

## Cycle Completion Summary
*[To be added when cycle is completed]*

## Design Document Reference
This implementation directly supports the user scenarios outlined in `docs/Initial_Singventory_Design.md`:

**Impromptu Visit Scenario (Lines 82-94):**
- Quick venue creation with minimal required information
- Song-venue association through "add venue" icon workflow
- Performance logging with optional notes ("too high", "too low", "just right")
- Rapid workflow for friends and social karaoke situations

**Recon Visit Scenario (Lines 95-110):**
- Pre-visit venue setup with full information entry
- Song candidate addition before visiting venue
- Venue song ID entry for preparation
- Post-visit key information and preference updates

**Repeat Visit Scenario (Lines 111-122):**
- Quick venue selection for known locations
- Display of researched songs with key information and frequency indicators
- Performance entry showing venue song IDs and key adjustments
- Visit completion with notes about cost, duration, companions

**Key Requirements from Design Document:**
- Bottom navigation: Songs, Venues, Visits, Settings (PlayStreak pattern)
- Quick performance logging optimized for live karaoke use
- Dual key input methods: dropdown selection AND step adjustments
- Search prioritizing frequently performed songs
- Offline-first operation for venues with poor connectivity
- Visit auto-save after each performance entry
- Explicit visit end/reopen capability