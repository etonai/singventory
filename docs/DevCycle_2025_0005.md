# Development Cycle 2025-0005

**Status:** ❌ TODO  
**Start Date:** TBD  
**Target Completion:** TBD  
**Focus:** Core Karaoke Session Management - implementing fundamental visit and performance logging system

## Overview

This development cycle addresses the critical gap in Singventory's functionality by implementing the core visit management and performance logging system. While DevCycle 4 successfully established comprehensive song/venue database management with associations and settings, users currently cannot perform the primary function of the app: tracking karaoke sessions. This cycle enables users to start visits, log performances during sessions, and manage their karaoke activity - the fundamental purpose of Singventory as described in the Initial Design document.

## Current Work Items

### Phase 1 - Visit Management Foundation
**Status:** ❌ TODO  
**Priority:** Critical  
**Description:** Implement the fundamental visit management system enabling users to start, manage, and end karaoke sessions

#### Phase Progress
**Phase 1 Visit Management Implementation:**
- ❌ TODO: Design and implement Visit entity with proper relationships to Venue
- ❌ TODO: Create StartVisitFragment for initiating karaoke sessions with venue selection
- ❌ TODO: Implement VisitViewModel with active visit state management
- ❌ TODO: Add visit status tracking (active vs completed visits)
- ❌ TODO: Create EndVisitFragment for closing sessions with notes and cost tracking
- ❌ TODO: Implement visit reopening capability for adding missed performances
- ❌ TODO: Add navigation integration for visit management workflows
- ❌ TODO: Create visit history display in main navigation

#### Technical Requirements
**Visit Entity Design:**
- Visit entity with venue relationship, timestamps, notes, cost, and active status
- Database schema supporting visit state management and history tracking
- Repository methods for visit CRUD operations and state transitions
- Foreign key relationships maintaining data integrity with venue references

**Visit Management Workflows:**
- **Start Visit**: Venue selection with autocomplete, automatic timestamp, optional pre-visit notes
- **Active Visit State**: Track current session, enable performance logging, show session duration
- **End Visit**: Capture total cost, visit notes, duration, and close session gracefully
- **Reopen Visit**: Allow adding missed performances to recently completed visits

**Navigation Integration:**
- Visit management as primary navigation destination
- Quick access to start new visit from main screen
- Active visit indicator throughout app when session is ongoing
- Visit history accessible from main navigation tabs

#### User Scenarios Addressed
**Impromptu Visit Workflow:**
- User arrives at Ozzie's → taps "Start Visit" → selects Ozzie's from venue list → begins session
- Active visit indicator shows throughout app during session
- User can end visit with notes about duration, cost, people present

**Recon Visit Workflow:**
- User plans research visit to RockBox → starts visit before entering venue
- Active visit enables performance logging for song testing
- Visit notes capture research findings and venue observations

**Visit Recovery Workflow:**
- User forgot to log performances → can reopen recent visit within reasonable timeframe
- Missed performances can be added retroactively with approximate timestamps

#### Implementation Notes
- Visit entity should include isActive boolean for state management
- Consider visit timeout mechanism for abandoned sessions
- Support both manual end visit and automatic session detection
- Visit timestamps should support both start and end times
- Repository should handle visit state transitions atomically

### Phase 2 - Performance Logging System
**Status:** ❌ TODO  
**Priority:** Critical  
**Description:** Implement comprehensive performance tracking during active visits, enabling users to log individual song performances with key adjustments and notes

#### Phase Progress
**Phase 2 Performance Logging Implementation:**
- ❌ TODO: Design Performance entity with relationships to Visit and Song
- ❌ TODO: Create PerformSongFragment for logging performances during active visits
- ❌ TODO: Implement song selection interface showing venue-associated songs with filtering
- ❌ TODO: Add key adjustment input supporting both absolute keys and step-based adjustments
- ❌ TODO: Create performance notes capture with optional immediate entry
- ❌ TODO: Implement real-time statistics updates (song performance counts, last performed dates)
- ❌ TODO: Add performance timestamp tracking within visit context
- ❌ TODO: Create ActiveVisitFragment showing current session and logged performances

#### Technical Requirements
**Performance Entity Design:**
- Performance entity linking Visit, Song with key adjustment, notes, and timestamp
- Foreign key relationships ensuring referential integrity
- Repository methods supporting performance CRUD and statistics calculation
- Atomic operations for performance logging with statistics updates

**Song Selection During Visits:**
- Filter songs by venue association during active visits
- Display venue-specific information (song IDs, preset key adjustments)
- Quick search and filter capabilities for large song collections
- Show performance history context (last performed at this venue, frequency)

**Key Adjustment System:**
- Dual input method: dropdown key selection AND +/- step adjustment buttons
- Auto-calculation between absolute keys and step adjustments
- Visual indication of key changes (Original: F# → Your key: D, -4 steps)
- Integration with existing MusicalKey enum from song management

**Statistics Integration:**
- Real-time updates to song.totalPerformances and song.lastPerformed
- Update venue-specific statistics in SongVenueInfo table
- Atomic database operations ensuring consistency during performance logging
- Immediate UI updates reflecting new performance statistics

#### User Scenarios Addressed
**Live Performance Logging:**
- During visit, user performs "On My Own" → opens app → quick song selection → logs performance with key adjustment
- Performance immediately updates song statistics and venue association data
- Optional notes capture for future reference ("too high", "great audience response")

**Key Discovery Workflow:**
- During recon visit, user tests song in venue's key → determines needs -2 steps adjustment
- Key adjustment auto-calculates and saves to venue-specific song information
- Future visits show preset adjustment for quick performance logging

**Performance Recovery:**
- User realizes they forgot to log several songs → can add performances to active or recently ended visit
- Performance timestamps reflect when songs were actually performed within visit timeframe

#### Implementation Notes
- Performance logging should be optimized for speed (under 30 seconds per entry)
- Consider batch performance entry for users who log multiple songs at once
- Performance entity should support both absolute timestamps and visit-relative timing
- Statistics updates must be atomic to prevent data inconsistency
- Integration with existing association system for venue-specific song information

### Phase 3 - Key Adjustment Display System
**Status:** ❌ TODO  
**Priority:** High  
**Description:** Implement comprehensive key adjustment visualization and user interface to display venue-specific key information during song selection and performance logging

#### Phase Progress
**Phase 3 Key Display Implementation:**
- ❌ TODO: Create KeyAdjustmentDisplayView component for showing key information
- ❌ TODO: Implement dual-format key display (absolute keys + step adjustments)
- ❌ TODO: Add key adjustment indicators to song selection screens during visits
- ❌ TODO: Create key adjustment summary in performance logging interface
- ❌ TODO: Implement automatic key adjustment calculation and display
- ❌ TODO: Add visual indicators for songs requiring key adjustments
- ❌ TODO: Create key adjustment input controls for venue-specific adjustments
- ❌ TODO: Integrate key display with existing song-venue association system

#### Technical Requirements
**Key Display Components:**
- Custom KeyAdjustmentView showing both absolute keys and step adjustments
- Visual format: "Venue: F# → You: D (down 4 steps)" with clear direction indicators
- Color coding for key adjustments (neutral, up steps, down steps)
- Integration with existing MusicalKey enum and calculation methods

**Song Selection Enhancement:**
- Key adjustment badges on song lists during active visits
- Quick visual indication of which songs need adjustment vs original key
- Sorting options prioritizing songs by key adjustment requirements
- Clear display of venue-specific key information in song selection dialogs

**Performance Logging Integration:**
- Automatic key adjustment display when logging performances
- Pre-filled key adjustment values based on venue associations
- Manual override capability for discovered key adjustments
- Real-time calculation and display of key relationships

#### User Scenarios Addressed
**Live Performance Selection:**
- During active visit, user browses available songs with clear key adjustment indicators
- Songs display "No adjustment needed" vs "Adjust down 3 steps" for quick decision making
- Key information helps user choose appropriate songs for their vocal range

**Key Discovery and Learning:**
- During recon visits, user can see and modify venue-specific key information
- Visual feedback when entering key adjustments helps understand relationships
- Key adjustment history helps user learn venue patterns and preferences

**Performance Optimization:**
- Quick identification of songs that work well in venue's default keys
- Easy filtering of songs by key adjustment requirements
- Performance history shows which key adjustments worked best at each venue

#### Implementation Notes
- Leverage existing MusicalKey.calculateKeyAdjustment() method for calculations
- Build upon existing SongVenueInfo.keyAdjustment and .venueKey fields
- Integrate with current song-venue association system from DevCycle 4
- Maintain consistency with existing UI patterns and Material Design
- Ensure key display works efficiently during live performance logging scenarios

### Phase 4 - Song-Venue Association Management
**Status:** ❌ TODO  
**Priority:** Critical  
**Description:** Implement comprehensive song-venue association screens enabling users to build venue-specific song catalogs with venue song IDs, keys, and performance data outside of active visits

#### Phase Progress
**Phase 4 Association Management Implementation:**
- ❌ TODO: Complete AssociateSongsWithVenueFragment functionality for venue catalog building
- ❌ TODO: Complete AssociateVenuesWithSongFragment functionality for song availability tracking
- ❌ TODO: Implement AssociationDetailsDialog for venue-specific data entry
- ❌ TODO: Add venue song ID input and management throughout association workflows
- ❌ TODO: Create navigation actions connecting association screens to main song/venue screens
- ❌ TODO: Implement search and filter functionality for association selection screens
- ❌ TODO: Add batch association operations for efficient catalog management
- ❌ TODO: Integrate association management with existing SongVenueInfo entity system

#### Technical Requirements
**Association Screen Architecture:**
- Complete existing AssociateSongsWithVenueFragment for selecting songs to add to venue catalogs
- Complete existing AssociateVenuesWithSongFragment for selecting venues where songs are available
- AssociationDetailsDialog for capturing venue-specific information (song ID, key, adjustments)
- Navigation integration with "Add venue" buttons from SongsAdapter and "Add song" buttons from VenuesAdapter

**Venue Catalog Management:**
- **Venue Song ID Entry**: Critical field for entering venue's internal song catalog numbers
- **Key Information**: Venue-specific key and adjustment entry during association
- **Batch Operations**: Multi-select capabilities for efficient association management
- **Search Integration**: Filter songs/venues during association selection for large catalogs

**Data Integration:**
- Leverage existing SongVenueInfo entity with venuesSongId, venueKey, keyAdjustment fields
- Utilize existing repository methods for association CRUD operations
- Maintain referential integrity with cascade delete operations
- Support import/export of association data through existing JSON system

#### User Scenarios Addressed
**Venue Catalog Building:**
- User discovers new venue → browses venue's song book → associates available songs with venue catalog IDs
- During research, user enters "Song #1425" for "Bohemian Rhapsody" at RockBox venue
- User captures key information: "Venue plays in Bb, I prefer F# (down 5 steps)"

**Song Availability Tracking:**
- User has favorite song → checks which venues have it → associates song with multiple venue catalogs
- Song shows availability at 3 venues with different catalog IDs and key information
- Quick reference showing "Available at: RockBox (#1425), Ozzie's (#2891), KaraokeBox (#K-456)"

**Pre-Visit Planning:**
- Before visiting venue, user reviews associated songs and their catalog information
- Quick access to venue song IDs eliminates searching through venue's catalog during visit
- Key adjustment information helps user plan appropriate songs for vocal range

**Catalog Discovery and Management:**
- During recon visits, systematic association of newly discovered songs
- Bulk association operations when venue provides complete song list
- Integration with performance logging to auto-associate songs discovered during visits

#### Implementation Notes
- Build upon existing association fragments and adapters (already partially implemented)
- Complete deferred functionality from DevCycle 3 Phase 2
- Critical dependency for Phase 2 (Performance Logging) and Phase 3 (Key Display)
- Essential for core user scenarios described in Initial_Singventory_Design.md
- Venue song ID field is fundamental for venue catalog integration
- Must work efficiently for users building catalogs of hundreds of songs per venue

## Cycle Notes
- This cycle addresses the fundamental gap in Singventory functionality
- Builds upon the solid foundation of song/venue management from DevCycles 1-4
- Enables the core user scenarios described in Initial_Singventory_Design.md
- Maintains offline-first design for use in venues with poor connectivity
- Follows established MVVM + Repository architecture patterns from previous cycles

## Design Document Reference
This cycle directly implements the core functionality described in `docs/Initial_Singventory_Design.md`:

**For each visit:**
- Date and time of arrival (Phase 1)
- List of songs performed (Phase 2) 
- Notes for tracking duration, people, food/drinks (Phase 1)
- How much spent (Phase 1)

**For each performance:**
- Song identification and venue context (Phase 2)
- Key adjustment for the song (Phase 2 & 3)
- Performance notes (Phase 2)
- Timestamp within visit (Phase 2)

**User Scenarios Enabled:**
- Impromptu visit logging at new venues (Phases 1 & 2)
- Recon visit workflow for song research (Phases 1, 2, 3 & 4)
- Repeat visit optimization with performance history (Phases 2 & 3)
- Key-aware song selection during live performances (Phase 3)
- Venue catalog building and song availability tracking (Phase 4)

## Future Cycles

### Potential DevCycle 6 Features
- Visit history analytics and performance insights
- Advanced performance filtering and search capabilities  
- Visit-based reporting and statistics visualization
- Enhanced venue discovery based on performance patterns

### Integration Opportunities
- Association Details Dialog integration with performance logging
- Advanced search enhancements for performance-based filtering
- Configuration options for visit management preferences
- Import/Export integration for visit and performance data

## Cycle Completion Summary
*[To be added when cycle is completed]*